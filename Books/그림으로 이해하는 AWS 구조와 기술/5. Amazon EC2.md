# Amazon EC2(Elastic Compute Cloud)란

* 컴퓨팅 용량을 제공하는 서비스로 서버에 필요한 세트를 클라우드에서 빌림.
    * 빌린 도구를 사용하여 자신의 서버를 만듦.
* EC2는 매니지드 서비스가 아니기 때문에 OS, 소프트웨어는 사용자가 직접 설치하고 운영.
    * AWS는 서버 및 네트워크 운영까지만 담당.
    * 자유도가 높은 반면 관리하기가 번거로움.
    * 어떻게 구상할지 어느 정도의 성능이 필요할지 설계적인 관점이 필요.

## EC2에 서버를 생성하는 장점

* 누구든지 바로 사용 가능
    * 클릭 한 번으로 생성. (관리 콘솔)
    * 준비된 것을 선택할 수 있음. (AMI, 인스턴스 유형)
    * 나중에 변경이 쉬움. (관리 콘솔, 인스턴스 유형)
* 여러 가지 선택 가능
    * CPU와 메모리 사양이 다양함. (인스턴스 유형)
    * OS나 소프트웨어의 종류 다양함. (AMI)
    * 연계하고 싶은 기능도 충실함. (다른 AWS 서비스)
* 백업 쉬움 (가상화 기술)
* 어디서든 접속 (클라우드)
* 물리적으로 다른 여러 장소에 설치 가능 (리전과 가용 영역)

## 편리한 서버 생성과 삭제의 장점

* 불필요한 리소스를 유지할 필요 없음.
* 서버에 문제가 생겨도 즉시 복구.
* 복제 및 스케일 아웃, 스케일 다운.
* 테스트를 위한 임시 서버.
* 불확실성이 많은 경우에 매우 유용.
    * 접속량이 얼마일지, 서버 사양이 얼마나 필요할지 등.
* 전문 지식 없이 쉽게 서버 생성 가능.

<br/>

# EC2 사용

## 설치

* 물리적인 작업(케이블 연결 등) : 관리콘솔
* 소프트웨어적인 작업(OS 설치 등) : SSH를 통한 원격 (클라우드가 아닌 환경과 같음)

## 주요 기능

|항목|내용|
|---|---|
|인스턴스|AWS 클라우드에 생성한 가상 서버.<br/>AMI로 같은 구성의 서버를 몇 번이고 생성 가능.|
|AMI|가상 이미지로 인스턴스 생성의 금형과 같음. (java의 class)<br/>OS만 설치된 유형부터 SW도 설정된 유형까지 다양.|
|키 페어|인스턴스 접속을 위한 인증에 사용하는 키|
|EBS|AWS 클라우드에서 사용할 수 있는 스토리지.<br/>인스턴스 스토리지로 사용.|
|보안 그룹|가상 방화벽으로 1개 이상의 인스턴스 트래픽을 제한.|
|Elastic IP|정적(고정) IPv4 주소.|

## EC2 사용 절차

1. AWS에 로그인
    * 리전 선택, 관리 콘솔 오픈.
    * EC2 대시보드 오픈.
1. EC2 인스턴스 생성
    * AMI 선택.
    * 인스턴스 유형 선택.
    * 네트워크와 IP 주소 할당.
    * 스토리지 추가.
    * 보안 그룹 설정.
    * 키 페어 선택(작성).
1. EC2 접속
    * SSH로 접속.
1. 소프트웨어 설치 및 설정

## 인스턴스 설정 항목

* 일반적인 서버 생성처럼 CPU, 메모리, OS, 웹 서버 종류 등을 검토해야 함.
* AWS에서는 다양한 인스턴스 유형, AMI를 제공하므로 적당한것을 골라도 됨.

|항목|내용|
|---|---|
|AMI|OS, SW 등 어떤 인스턴스를 만들 것인지 정하고 해당하는 AMI 선택.|
|인스턴스 유형|인스턴스의 장비 사양.<br/> CPU, 메모리, 장비 유형을 결정.|
|리전|서버를 설치할 지역.<br/>전 세계에 이중화를 고려한 경우는 다른 나라에도 설치.|
|네트워크|EC2 인스턴스를 배치할 네트워크.<br/>AWS의 VPC(AWS 계정 전용 가상 네트워크)에서 선택.<br/>|
|서브넷|설치할 네트워크 범위.<br/>VPC내에 어떤 서브넷을 설치할지 선택.<br/>서브넷 선택이후 가용 영역이라고 하는 설치 장소와 어떤 범위에 사설 IP가 부여될지 결정.|
|IAM 역할|인스턴스의 접속 권한 정책 설정.<br/>다른 서비스에 접속하고 싶을때 할당.|
|스토리지의 용량과 종류|서버 장비의 스토리지로 OS가 설치된 장소에 있음.<br/>기본적으로 EBS를 선택하고 사용할 디스크 용량과 스토리지의 종류 선택.<br/>용도에 따라 인스턴스 스토어(전원이 끊기면 데이터가 사라지지만 읽기 성능이 빠름)를 선택.<br/>S3같은 외부 스토리지는 선택 불가.|
|태그(EC2 인스턴스의 레이블)|인스턴스에 임의의 태그 부여.|
|보안 그룹|프로토콜별로 포트나 IP 주소, 또는 양쪽 모두 필터링 설정.|

<br/>

# 인스턴스 요금

* 요금 = 인스턴스 사용량 + EBS 요금 + 통신 요금 + 그 외 옵션

## 인스턴스 사용량

인스턴스가 가동한 시간(초) 단위로 과금. 단위는 인스턴스 유형에 따라 다르고 고기능일수록 비쌈.

## EBS(스토리지) 요금(용량 X 단가)

보유한 용량 단위로 과금되며 스토리지 성능(SSD인지, HDD인지, IOPS 담보를 할지 여부 등)에 따라 단가가 다름.
저장 용량 단위가 아님을 주의. 인스턴스가 정지하고 있는 동안에도 요금이 부과됨.

## 통신 요금(아웃바운드 통신 요금)

인터넷에서 인스턴스로 들어오는(인바운드) 통신료는 무료, 인스턴스에서 인터넷으로 나가는(아웃바운드)만 유료.
요금은 리전에 따라 조금 다름.

## 그 외 옵션

Elastic IP 서비스 등 옵션을 사용할 경우 해당 요금이 추가.

<br/>

# AMI(Amazon Machine Image)

* 소프트웨어 구성을 기록한 템플릿.
* 동일한 인스턴스를 대량으로 쉽게 생성 가능.
* 특히 같은 서버를 여러 대 구축해야 할 경우에 편리. 
    * 즉, 같은 서버의 생성과 삭제가 쉬움.
    * 소프트웨어 설정까지 동일하면 더 유용.

## 제공되는 OS 이미지

* AWS 공식 AMI 외에 커뮤니티판이나 기업이 생성한 AMI도 제공됨.

#### ※ 주요 AMI

|AMI|내용|
|---|---|
|Amazon Linux|아마존이 제공하는 레드햇 기반 리눅스|
|CentOS|CentOS 리눅스|
|Red Hat Enterprise Linux|레드햇 리눅스|
|Debian GNU/Linux|데비안 리눅스|
|Ubuntu Server|우분투 리눅스|
|SUSE Linux Enterprise Server|수세 리눅스|
|Microsoft Windows Server|윈도 서버|
|LAMP Certified by Bitnami|리눅스와 아파치, MysSQL PHP 서버|
|Tomcat Certified By Bitnami|톰캣 서버|
|WordPress powered by AMIMOTO|블로그 시스템 워드프레스|
|Movable Type|블로그 시스템 무버블 타입)|
|NGINX Open Source Certified by Bitnami|웹 서버인 엔진엑스 서버|
|Redmne Certified by Bitnami|진행 현황 관리 도구인 레드마인 서버|
|NextCloud Powered by IVCISA|파일 공유 도구인 NextCloud 서버|
|SFTP Gateway|암호화 FTP 서버|

## AMI 요금

* 경우에 따라 무료와 유료가 있음.
* 마이크로소프트가 제공하는 윈도 서버와 같이 원래 유료인 경우는 AMI도 유료.
* AMI를 개인이 생성할 경우엔 이미지의 용량에 따라 요금이 부과.

## AMI를 직접 생성

* AMI는 개인이 만들 수 있음.
* 같은 구성의 서버 복제, 구축한 서버의 백업용으로 사용시 편리.
* 마켓플레이스라는 장소에 배포 가능.
* AMI는 EC2 인스턴스에서 생성.

<br/>

# 인스턴스 유형

* 인스턴스 유형이란 머신의 용도.
* 용도는 다섯 가지로 구분되어 있고 각 여러 인스턴스 유형이 존재.

#### ※ 주요 인스턴스 유형

|용도|인스턴스 유형|내용|
|---|---|---|
|범용|A1, T2, T3, M5, M4, M5a, T3a|일반적인 서버.<br/>부하가 일정한 서버의 경우 사용.<br/>버스트 기능을 지원하는 유형도 존재.|
|컴퓨팅 최적화|C5, C5n, C4|연산 능력이 높은 서버.|
|메모리 최적화|R5, R5a, X1e, X1, 고성능 메모리, z1d|메모리 액세스 속도를 높인 서버.|
|메모리 최적화|R4|대용량 메모리를 탑재한 서버.|
|가속화된 컴퓨팅 최적화|P3, P2, G3, F1|머신 러닝 등에 사용되는 GPU를 탑재한 유형 및 그 래픽 기능이 높은 유형.|
|스토리지 최적화|H1, I3, D2|스토리지를 최적화한 유형.<br/>I3은 SSD 기반.|

## 인스턴스의 유형과 크기

* 인스턴스의 유형과 크기의 조합이 성능을 의미.
* 인스턴스의 크기에는 t2의 경우 nano부터 4xlarge까지 8종류의 크기가 있음.
* t2.micro처럼 유형과 크기를 붙여서 표시.
    * t2 : 인스턴스 유형 (대략적인 용도)
    * micro : 인스턴스 크기 (CPU나 탑재 메모리의 용량 등의 성능)
* 유형과 크기에 따라 단가가 달라짐.

<br/>

# Amazon EBS(Elastic Block Store)

* 영구적인 블록 스토리지 볼륨으로 EC2 인스턴스와 조합하여 사용.
* 블록 스토리지 볼륨은 데이터를 바이트 블록 단위로 디스크에 저장하는 일반적인 방식.
* HDD와 SSD를 선택을 지원.
    * HDD : 대용량 지원, SSD에 비해 가격이 싸지만 성능이 낮음.
    * SDD : 가격이 비싸지만 IOPS(Input Output Per Second)(1초간 처리할 수 있는 입출력 수)가 빠름.

## EBS의 볼륨 유형

* HDD, SSD 모두 IOPS 성능을 보장하는 유형과 스루풋에 최적화된 유형 등이 존재.
* 성능과 요금을 비교해서 선택.

## EBS의 기능

|기능|설명|
|---|---|
|탄력적 볼륨|볼륨 크기를 간단히 조정|
|스냅샷|어떤 시점의 데이터를 통째로 저장|
|데이터 라이프 사이클 매니저|일정에 따라서 스냅샷을 생성, 삭제|
|최적화 인스턴스|특정 인스턴스 유형을 최적화 인스턴스로써 읽기 쓰기를 고속화|
|암호화|데이터 볼륨, 부팅 볼륨 및 스냅샷을 암호화|

## EBS 요금

* 단가 X 저장 시간으로 산출.
* 단가는 저장하고 있는 용량(GB 단위).
* 단가는 디스크의 종류에 따라 다름.
* 인스턴스를 정지해도 요금이 부과.

