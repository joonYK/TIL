# Amazon VPC(Virtual Private Cloud)

* AWS 계정 전용 가상 네트워크 서비스.
    * 네트워크와 서브넷 범위, 라우팅 테이블, 네트워크 게이트웨이 등 가상 네트워킹 환경 설정.
* AWS에서 제공하는 리소스만 설치 가능.
* EC2나 RDS의 경우 VPC 없이는 서버 생성 불가.

## VPC의 구성

* VPC 내에 서버를 설치하면 해당 네트워크에 소속됨.
* 별도 설정 없으면 VPC 자체는 격리된 네트워크가 됨.
* 외부와의 통신은 인터넷이나 회사 내 LAN과 연결 필요.

## 기능

* 가상 환경이기 때문에 물리적인 네트워크와 다른 점도 있지만 기본 개념은 같음.
* IPv4, IPv6 둘 다 사용 가능.

#### ※ 주요 기능

|항목|내용|
|---|---|
|CIDR 블록|서브넷이며 네트워크를 나눈 범위.<br/>VPC 생성시 네트워크 범위를 CIDR로 정하고 더 작은 서브넷으로 나눔.|
|서브넷 마스크|네트워크의 크기를 계산하는 값.<br/>CIDR은 서브넷 마스크의 표기법 중 하나.|
|가용 영역|서브넷이 구축된 물리적 장소.|
|인터넷 게이트웨이|인터넷 접속 출입구.<br/>VPC를 인터넷에 연결하지 않으면 불필요.|
|라우팅|어떤 데이터를 어디에 보낼지 조정.<Br/>게이트웨이와 라우팅으로 송수신 설정을 해야 VPC가 인터넷 접속 가능.<br/>|
|라우팅 테이블|라우팅에 대한 설정이 기록된 테이블.|
|보안 그룹|AWS가 제공하는 가상 방화벽.<br/>인스턴스 단위로 설정, 유입되는 데이터는 '거부'가 기본 설정.|
|네트워크 ACL|AWS가 제공하는 가상 방화벽으로 서브넷 단위로 설정.|

## VPC 네트워크의 특징과 라우팅 테이블

* VPC와 네트워크와 일반 네트워크의 큰 차이점은 라우터.
* VPC는 소프트웨어가 라우터 역할을 수행.
    * 라우팅 테이블 하나에 서브넷 여러 개를 설정 가능.
* 물리 서버는 LAN 케이블과 와이파이로 라우터와 연결, 클라우드는 라우팅 테이블로 연결.
* 일반적인 서브넷 사이의 통신은 라우터로 하지만, VPC의 경우는 라우터 없이 통신 가능.
* VPC 하나에 인터넷 게이트웨이 한 개만 설정 가능.
* 라우터와 인터넷 게이트웨이는 명시적인 IP 주소 부여 없음.

<br/>

# 사용

## 설정을 위해 꼭 필요한 확인 사항

### 1. 인터넷 연결 여부

* 인터넷 연결이 필요하면 인터넷 게이트웨이 설정 필요.

### 2. 오토 스케일링

* 서버가 자동으로 늘어나기 때문에 IP 주소를 많이 확보해야 함.

### 3. 보안 그룹과 네트워크 ACL

* 인스턴스 용도에 맞는 포트 설정 고려.
* 모든 포트가 닫힌 것이 기본 설정이기 때문에 기본 설정 변경 필요.
* 기본 VPC, 기본 서브넷과 보안 그룹을 제공해서, 잘 모르면 기본 VPC 사용.

## 사용 절차

### 1. AWS에 로그인

* 리전 선택 > 관리 콘솔 접속 > VPC 대시보드 접속.

### 2. VPC 생성

* VPC 이름을 정함.
* CIDR 블록에 네트워크 범위 설정.
* 테넌시(하드웨어의 점유 여부)를 선택.

### 3. 서브넷 설정

* 서브넷 이름을 정함.
* 대상 VPC 선택.
* 가용 영역 선택.
* CIDR 블록(서브넷)을 설정.

### 4. 인터넷 연결

* 인터넷 게이트웨이를 생성.
* 인터넷 게이트웨이와 VPC를 연결.
* 라우팅 설정(라우팅 테이블을 생성하고 설정).

<br/>

# 기본 VPC

* 네트워크 지식이 없어도 이용할 수 있도록 리전별로 기본 VPC 제공.
* 특별한 설정 없이 바로 사용 가능.
* 특별한 요건이 없으면 기본 VPC 사용이 좋음.

## 기본 VPC의 구성

* 서브넷과 인터넷 게이트웨이가 기본적으로 구성되어 있음.
    * 인터넷이 필요 없으면 별도로 생성하거나 기본 VPC를 변경.
    * VPC 마법사로 쉽게 생성 가능.
* 네트워크 범위는 사설 IP 주소 172.31.0.0/16 부여.
* 기본 서브넷이라는 서브넷이 가용 영역별로 한 개씩 생성.

<br/>

# 서브넷과 DHCP

## 서브넷

* 커다란 네트워크를 작게 나눈 네트워크.
* 네트워크를 분할해서 직접 통신 범위 축소, 방화벽 설정을 통한 보안 강화.
* AWS는 어떤 가용 영역에 서브넷을 둘지 설정. 
    * AWS의 서브넷은 물리적인 장소를 특정.
* VPC는 사용 가능한 네트워크 범위 생성, 그 아래에 용도에 따라 서브넷 생성.
    * 서브넷 A는 공개, 서브넷 B는 비공개처럼 역할 부여 가능.
* 일반적으로 서브넷끼리 통신은 라우팅이 필요, VPC는 라우팅 없이 가능.

## 네트워크의 범위와 CIDR(Classless Inter-Domain Routing) 표기

* CIDR은 네트워크와 서브넷의 범위를 나누는 데 사용되는 표기법.
* 프리픽스 표기라고도 하며, /24 처럼 슬래시 뒤에 네트워크 길이 표시.
* CIDR은 IP의 주소 수를 나타냄.
    * /24는 256개, /20은 4,096개.
    * 2의 '32 - 네트워크 길이' 제곱.
* 네트워크 범위는 범위 안에서 가장 첫 번째 IP 주소와 CIDR 순으로 표기.
    * 172.31.0.0/16에서 /16은 65,536개로 172.31.0.0 ~ 172.31.255.255가 네트워크 범위.

## 네트워크 클래스

* 네트워크 규모에 따라 A, B, C 세 클래스 존재.

|클래스|CIDR|IP 주소 수|사설 IP 범위|
|---|---|---|---|
|A|/8 ~ /15|131,072 ~ 16,777,216|10.0.0.0 ~ 10.255.255.255|
|B|/16 ~ /23|512 ~ 65,536|172.16.0.0 ~ 172.31.255.255|
|C|/24 ~ /32|1 ~ 256|192.168.0.0 ~ 192.168.255.255|

* 기본 VPC는 B 클래스, /20으로 분할한 서브넷이 각 가용 영역에 구성.
* /20은 IP 주소 4,096개로 오토 스케일링에 충분.
* 서브넷은 /16 이하여야 하기 때문에 A 클래스는 서브넷 설정 불가.

## DHCP(Dynamic Host COnfiguration Protocol)

* DHCP는 사용할 수 있는 IP 주소 풀을 보유하면서, 클라이언트에게 자동으로 IP를 할당하는 서버.
* DHCP에서 각 호스트(인스턴스)에 IP 주소 자동 할당.
    * 인스턴스가 추가되면 해당 서브넷 범위의 IP 주소 중 하나가 할당.

## 예약 IP 주소

* 서브넷의 첫 번째 ~ 네 번쨰, 마지막 IP 주소는 AWS에 예약된 IP 주소.
* 실제 사용가능한 IP 주소가 256개라면 5개를 제외한 251개.






