# S3(Simple Storage Service)

* 스마트한 객체 스토리지 서비스로 데이터를 객체 단위로 관리.
* 인터넷상에 데이터를 저장하는 장소를 제공.
* 용량 제한 없음.
* 기능이 많으며 대표적으로 웹 서버 기능, 쿼리 기능이 있음.
    * 간단하게 웹 서버 구축, 쿼리를 이용해 집계 가능.
* 클라우드이기 때문에 확장 축소 쉬움.

## S3 특징

### 1. 확장성

* 사용 목적에 맞게 다양한 스토리지 클래스가 있음.
* 수명 주기 정책을 통해 자동으로 이동 가능.

### 2. 가용성, 내구성

* 99.999999999%의 데이터 내구성을 가지고 있어 장애, 오류, 위협에 강함.
* S3 객체는 최소 4개의 가용 영역에 자동으로 복제되어 보존.

### 3. 신뢰성

* 암호화 기능과 접근 관리 도구가 있어 보안이 좋음.
* 각종 규정을 준수하며 감사 기능을 갖춤.

### 4. 다양한 관리 기능

* 스토리지 클래스 분석, 수명 주기 정책 등 각종 관리 기능이 있음.
* 관리 기능을 사용하면 실제 사용 환경에 맞는 스토리지 클래스 선택 가능.

### 5. 스마트한 기능

* S3 Select라는 데이터에 쿼리를 실행하는 기능과 서비스 존재.
* Althena, Redshift Spectrum 등의 분석 서비스와 호환.
* Lambda와 연동 가능.

## 요금 체계

* 스토리지 클래스(스토리지의 종류)와 리전에 따라 다름.
* 기본적으로 보유하고 있는 용량과 전송량을 기준으로 종량 과금. (저장 용량 + 전송량)
* 저장 용량
    * 일할(일단위 나눔)하여 계산, 30/90/180일 단위로 계산하는 경우 등 방식 다양.
    * 최소 용량 요금이 설정되는 경우도 있음.
* 전송량
    * S3에서 파일을 받거나 보낼 때 발생하는 요금.
    * 수신 요청(GET)이나 송신 요청(PUT)에 대해 1GB 단위로 과금. 
        * 수신 요청 : 파일 다운로드, 페이지 요청
        * 송신 요청 : 파일 업로드

<br/>

# 스토리지 클래스

* 스토리지의 종류로 액세스 패턴에 따라 다양.
* 버킷(객체를 저장하는 컨테이너) 단위가 아닌 객체(파일) 단위로 클래스 선택 가능.
* 상황에 따라 변경 가능.
    * 수명 주기 정책으로 자동 수행 가능.

## 스토리지 클래스 종류

### 1. Standard

* 3곳 이상의 AZ에 데이터가 저장되어 99.99% 가용성 보장.
* 데이터 검색 요금과 최소 용량 요금 없음.
* 일할 계산되므로 쉽게 사용하기 좋은 클래스.

### 2. Intelligent-Tiering

* 빈번한 액세스와 간헐적 액세스 계층 존재.
* 어디에 저장할지는 객체별로 모니터링하여 결과에 따라 자동으로 이동.
    * 30일간 연속으로 액세스 없으면 간헐적 액세스 계층, 늘어나면 빈번한 액세스 계층으로 이동.
* 액세스 빈도가 자주 바뀔시 유용.
* 검색 요금, 액세스 계층간 이동 요금 없음.
* 최소 저장 기간에 대한 요금이 있음.

### 3. Infrequent Access

* Standard에 비해 저장 요금이 낮지만 액세스 요금이 높음.
* 액세스 빈도가 낮고 용량이 큰 데이터에 적합.
* Standard - Infrequent Access : 최소 세 개 이상의 AZ에 저장.
* One Zone - Infrequent Access : 한 곳의 AZ에 저장.
    * 해당 지역에 물리적인 문제 발생시 데이터 유실 가능.

### 4. Reduced Redundancy Storage(RSS)

* Standard에 비해 이중화 수준을 낮춰 낮은 가격을 제공.
* 저장되는 AZ가 한 군데이므로 데이터 유실 가능성 존재.
* Standard의 옵션격인 클래스.

### 5. S3 Glacier/S3 Glacier Deep Archive

* 데이터 아카이브와 장기간 백업을 고려한 클래스.
* 내구성이 좋고 가격이 낮아 대용량 데이터를 저렴한 가격에 보관 가능.
* 데이터는 볼트라고 하는 컨테이너에 저장.
* 저장된 데이터를 읽는 경우 다른 S3 버킷으로 옮겨야 하는 작업이 필요.
* 검색시 Glacier상의 데이터와 검색 대상의 데이터 양쪽에 요금이 부과됨.

<br/>

# S3 사용

* S3는 파일을 버킷에 저장하며 파일을 객체라고 명명.
* 객체는 버킷, 객체 키, 버전으로 관리.

## 조작

* 버킷 생성, 각종 설정, 업로드 등 관리 콘솔에서 조작.
* API와 SDK를 통한 조작 방식도 지원.
* AWS Transfer foe SFTP가 제공되어 SFTP로 액세스 가능.

## 용어

|항목|내용|
|---|---|
|객체|S3의 엔티티 단위로 텍스트나 이미지 등의 파일.|
|버킷|객체를 저장하는 컨테이너로 모든 객체는 버킷에 저장.|
|버킷명|버킷의 명칭은 유일해야 함.<br/>웹 서버로 사용시 도메인명으로 사용.|
|객체 키|객체 식별자.<br/>버킷, 객체 키, 버전을 조합해서 객체 식별.|
|객체 메타데이터|이름과 값의 세트로 객체를 업로드할 떄 설정 가능.<br/>사람이 파일을 쉽게 관리하기 위한 데이터.<br/>객체 키는 S3가 파일을 식별하기 위해 사용.|
|리전|버킷의 물리적인 보관 장소가 있는 지역.|
|Amazon S3의 데이터 일관성 모델|가용성을 위해 데이터 자동 복제/저장하지만 쓰기 지연으로 인한 데이터 불일치 방지를 위해 데이터 무결성 보장.<br/>복제가 모두 반영 될때까지 시간 다소 걸릴 수 있음.|
|버전 관리|여러 버전을 보관.<br/>다른 버전은 별도의 객체로 취급 가능.|
|로그|버킷이나 객체 단위로 로그 기록 가능.<br/>객체의 경우 유료.|
|암호화|데이터를 자동으로 암호화.|
|액세스 제어|버킷에 대한 권한 설정.|
|웹 서비스|버킷을 웹 사이트로 사용 가능.|

## 사용 절차

### 1. AWS에 로그인

* 리전 선택, 관리 콘솔 오픈.
* S3 대시보드 오픈.

### 2. 버킷 생성

* 버킷명 설정.

### 3. 버킷 설정

* 웹 서버로 사용할 경우 Static website hosting 설정.
* 접근할 수 있는 사용자 설정.

### 4. 파일 업로드

* 관리 콘솔이나 전용 도구에서 파일 업로드.

## 버킷 생성 전 검토 사항

* 버킷을 생성한 후에는 이름과 리전 변경 불가.
* 웹 서버로 사용할지 파일 서버나 로그 저장소로 사용할지 고려 필요.
* 웹 서버로 사용 시 버킷에 대한 공개, 도메인, 익명 접속 허가 등 고려.
    * 소유한 도메인을 사용할 시 버킷명을 도메인명과 동일하게 세팅.
    * 테스트용 버킷 생성 및 확인을 먼저 진행하면 좋음.
* 파일 서버는 사용법에 맞게 도구나 SFTP 등 준비.
* 로그 저장소는 접속 대상과 인증 방법 고려.

<br/>

# 객체와 버킷

* 버킷은 윈도의 드라이브, 객체는 파일과 같은 것.
* 버킷은 폴더가 아니므로 버킷 안에 버킷 생성 불가.
* 버킷은 AWS 계정 하나당 100개 생성 가능.
    * 별도 신청시 1,000개.
* 객체는 단순 파일이 아닌 관리를 위한 메티데이터를 포함.
    * 생성일시, 크기 등.
* 버킷에 저장 가능한 객체 수나 용량에 제한이 없음.
* 객체는 버킷에 계층 구조가 아닌 병렬로 배치.
    * 폴더나 디렉토리 개념 없음.
    * 편의를 위해 관리 콘솔에서는 폴더로 표시됨.

## 버킷 생성

* 버킷 생성 시 리전과 버킷명 변경 불가.
* 버킷명은 S3 안에서 유일해야 함.
    * 다른 사용자가 쓰고있는 버킷명 생성 불가.
    * 리전을 변경해도 같은 버킷명 생성 불가.

## 버킷 명명 규칙

```
버킷명 예시 : gihyo.bucket.marvelous.sample
```

* 버킷명은 처음과 끝에 알파벳이나 숫자 사용.
* 3글자 이상 63글자 이하.
* DNS 명명 규칙에 따라야 함.
    * IP 주소형식 사용 불가.
    * 대문자나 언더스코어 사용 불가.

