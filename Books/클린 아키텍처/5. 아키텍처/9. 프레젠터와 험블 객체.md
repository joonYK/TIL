# 헙블 객체 패턴

테스트하기 어려운 행위와 테스트하기 쉬운 행위를 단위 테스트 작성자가 쉽게 분리하도록 고안된 디자인 패턴이다. 행위들을 두 개의 모듈(또는 클래스)로 나누고, 이 중 하나가 험블이다.

* 가장 기본적인 본질만 남기고, 테스트하기 어려운 행위는 험블 객체로 옮김.
* 험블 객체가 아닌 곳에 테스트 하기 쉬운 행위를 모두 옮김.

<br/>

# 프레젠터와 뷰

GUI는 화면을 보면서 각 요소가 필요한 위치에 적절히 표시되었는지 검사해야하기 때문에 단위 테스트 작성이 어렵다. 이런 경우 두 부류의 행위를 분리하여 프레젠터와 뷰라는 서로 다른 클래스로 만들 수 있다.

## 뷰

* 뷰는 험블 객체이고 테스트하기 어려움.
* 이 객체에 포함된 코드는 가능한 한 간단하게 유지.
    * 데이터를 GUI로 이동시키지만 데이터를 직접 처리하지 않음.
* 뷰 모델의 데이터를 화면으로 로드만 할 뿐, 다른 역할은 없음.

## 프레젠터

* 테스트하기 쉬운 객체.
* 애플리케이션으로부터 데이터를 받아 화면에 표현할 수 있는 포맷으로 만듦.
    * 날짜 관련 객체, 금액 관련 객체 등을 적절한 포맷의 문자열로 변환.
* 변환된 포맷 데이터를 뷰 모델이라고 하는 간단한 데이터 구조에 담음.
     * 뷰는 뷰 모델에서 이 데이터를 찾아서 화면을 그림.

<br/>

# 테스트와 아키텍처

테스트 용이성은 좋은 아키텍처가 지녀야 할 속성이다. 험블 객체 패턴으로 행위를 테스트하기 쉬운 부분과 테스트하기 어려운 부분으로 분리하면 아키텍처 경계(예를 들어, 프레젠터와 뷰)가 정의된다. 

<br/>

# 데이터베이스 게이트웨이

유스케이스 인터랙터와 데이터베이스 사이에 데이터베이스 게이트웨이가 위치한다. 이 게이트웨이는 다형적 인터페이스로 애플리케이션이 DB에 수행하는 CRUD 작업과 관련된 메서드를 포함한다.

## 유스케이스

* 유스케이스 계층은 SQL을 허용하지 않음.
* 유스케이스 계층은 필요한 메서드를 제공하는 게이트웨이 인터페이스를 호출.
* 애플리케이션에 특화된 업무 규칙을 담고 있어서 테스트가 쉬움.
    * 게이트웨이는 테스트 대역으로 교체해서 테스트 가능.

## 데이터베이스 게이트웨이 구현체

* 인터페이스의 구현체는 데이터베이스 계층에 위치하며, 이는 험블 객체.
* 구현체에서 직접 SQL을 사용.
* 게이트웨이의 메서드에서 필요한 데이터에 접근.

<br/>

# 기타

## ORM

ORM은 데이터베이스 계층에 위치하며, 게이트웨이 인터페이스와 데이터베이스 사이에서 일종의 또 다른 험블 객체 경계를 형성한다.

## 서비스 리스너

애플리케이션이 다른 서비스와 반드시 통신해야 하는 경우, 다른 서비스와 통신하는 서비스 모듈과 다른 서비스와 통신하기 위한 데이터와 애플리케이션에서 사용하기 편리한 데이터간에 변환을 담당하는 모듈을 적절히 분리할 수 있다.

<br/>

# 결론

각 아키텍처 경계마다 경계 가까이 숨어있는 험블 객체 패턴을 발견할 수 있다.

* 경계는 테스트하기 어려운 무언가와 테스트하기 쉬운 무언가로 분리됨.
* 경계를 넘나드는 통신은 거의 모두 간단한 데이터 구조를 수반.
