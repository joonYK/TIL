# 대규모 서비스를 지탱하는 기술

## 압축 프로그래밍

대규모 서비스를 운영할 때는 디스크 I/O는 줄이고 메모리 캐싱 효율은 높여야 한다. 그래서 메모리가 부족하다면 먼저 메모리 추가를 고려하고, 메모리 추가가 어렵다면 분산을 고려해서 최대한 데이터와 메모리 크기 차이가 나지 않도록, 그래서 데이터가 메모리에 최대한 캐싱되도록 하는것이 주 목적이었다.

그리고 또 하나 데이터 크기 자체를 줄이는 압축 기술도 고려할 수 있다. 그 중에서도 정수열을 압축할 수 있는 VB Code라는 알고리즘이 존재한다.

## VB Code(Variable Byte Code, 가변길이 바이트 부호)

정수의 부호화 방법 중 하나로, 현대 컴퓨터는 보통 5라는 숫자를 고정길이 32비트로 00000000 00000000 00000000 00000101 로 표현한다.

그러나 여기서 5라는 숫자는 마지막 1바이트만 사용해도 표현할 수 있으며, 앞의 3개 바이트는 굳이 필요하지 않다. 그래서 앞부분의 사용하지 않는 바이트를 제거하고 최소한의 바이트만 사용하는 것이 VB Code이다.

### Continuation 비트

VB Code는 첫 1비트가 플래그(continuation 비트)이며, 남은 7비트로 바이너리 부호를 표현한다. 만약 바이트의 첫 비트가 1이면 이 정수열의 비트열은 이 바이트에서 끝이라는 것을 표현한다.


```
예제(차례대로 수치, 바이너리 부호, VB Code)

5       00000000 00000000 00000000 00000101     10000101
130     00000000 00000000 00000000 10000010     00000001 10000010
```

* 5는 하나의 바이트로 표현이 가능.
* 130은 2개의 바이트가 필요.
    * 128(첫 바이트) + 2(두 번째 바이트).
    * 첫 바이트는 마지막 바이트가 아니므로 첫 비트가 0이고 마지막 하위 7비트가 128을 나타냄.
    * 두 번째 바이트는 마지막 바이트이므로 첫 비트가 1이고 마지막 하위 7비트가 2를 나타냄.

### 핵심 계산

* 각 바이트 8비트의 처음 1비트는 플래그이므로 정수를 표현하는것은 뒤의 7비트.
* 1비트로 0~127까지 표현 가능.
* 오른쪽 바이트부터 더하면, (0~127) + (128 * (1~127)) + (128제곱 * (1~127)) ...