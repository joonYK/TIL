# 대규모 서비스를 지탱하는 기술

## MySQL 인덱스 특성

* 인덱스가 대상 컬럼이 사용될 때는 where 조건, order by, group by 시에 사용됨.
* 인덱스가 적용되는 컬럼은 명시적으로 인덱스를 추가하거나, 기본키이거나, 유니크 제약조건이 걸린 컬럼.
* 하나의 select 절에 복수 인덱스를 사용하고자 한다면, 복합 인덱스 생성 필요.
    * MySQL은 한 번의 쿼리에서 하나의 인덱스만 사용.

## explain 명령으로 인덱스가 작용하는지 확인

SQL을 던지기 전에 explain 명령을 실행하면 MySQL이 인덱스가 작용하는지 여부를 알려준다.

### 예시

```sql
explain select url from entry where eid = 9615899;
```

#### 중요 출력 정보

1. possible_keys : 인덱스 키로서 가능성이 있는 키의 이름. (eid)
2. key : 실제로 사용되고 있는 키. (eid)
3. rows : 조사한 행의 개수. (1 행, eid가 9615899인 건)
4. Extra : 인덱스 작용법.
    * 만약 Using where 외에 Using filesort나 Using temporary가 나오면 좋은 쿼리라고 할 수 없음.

## 인덱스가 잘 적용되는지 찾기 쉬운 구조를 생각

요즘은 ORM 프레임워크를 사용해서 해당 프레임워크가 SQL을 자동으로 생성하는 경우도 있다. 그래서 인덱스를 제대로 타지 못하는 SQL이 사용될 수도 있는데, 이것을 감시할 수 있는 방안이 필요하다.

실행된 SQL이 로그에 남도록 한다거나, 생성되는 SQL을 매번 explain 해서 개발자에게 보고하는 자동화 처리를 하는 등의 구조를 만든다.