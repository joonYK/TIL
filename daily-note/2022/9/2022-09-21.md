# 대규모 서비스를 지탱하는 기술

## DB 인덱스의 중요성

인덱스는 색인이며 빠른 탐색을 위해 사용된다. 예를 들면, 책의 마지막 부분에 책 속의 키워드나 구절 등을 페이지와 함께 쉽게 찾아갈 수 있도록 나열해 놓은 것과 같다.

빠른 탐색을 위한 자료구조인 트리를 사용하며, DB에서는 B트리의 파생인 B+트리를 사용한다.

### B트리

각 노드가 자식으로 여러 개의 노드를 가질 수 있으며, 트리가 한쪽으로 치우지지 않도록 평형되게 유지한다. 그리고 디스크상에 구축하기 알맞은 형태의 트리이다.

#### 디스크에 최적화됨

B트리는 노드의 개수를 여러 개로 둘 수 있기 때문에, 그 구성을 디스크상의 하나의 블록(4KB)로 구성할 수 있다. 그러면 하나의 노드를 읽어서 캐싱해두면 같은 노드 내에 포함된 데이터는 디스크의 검색 없이 메모리에서 찾을 수 있고, 디스크 접근은 노드에서 하위 노드로 찾아갈때만 일어난다.

#### 이진 트리와의 차이

이진 트리는 루트노드가 1개로 이루어져있고, 그 하위의 노드들은 자식을 딱 2개만 가질 수 있다. 그래서 쉽게 트리가 한쪽으로 편향되서 검색시에 선형검색 같은 비효율적인 탐색이 일어나기 쉽고, 자식 노드가 2개뿐이니 노드를 모아서 하나의 페이지 크기만큼 구성하는 것처럼 디스크에 최적화할 수 없다. 그래서 이진 트리 구조로 인덱싱을 구성하게 되면, 디스크 I/O가 엄청 많이 발생할 것이다.

### B+트리

B+트리는 각 노드내에 자식 노드로의 포인트만 가지고 있으며, 실제 데이터는 트리를 구성하는 제일 마지막 노드인 잎(leaf) 노드에만 있는 구조이다. 그리고 DB에 데이터를 저장하는데 좀 더 최적화된 데이터 구조라고 한다.

