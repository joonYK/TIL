# 대규모 서비스를 지탱하는 기술

## 서버 규모조정(scaling)

보통 대규모 서비스의 환경은 서버 여러대를 두는 스케일 아웃 전략으로 부하를 분산해서 서비스의 안정성을 유지시키려고 한다. 

### 스케일 아웃 전략을 사용하는 이유

* 비용면에서 스케일 업보다 유리함.
    * 하드웨어 부품의 가격이 10배 비싸다고해서 10배만큼의 성능이 나오지 않음.
    * 저가의 서버를 여러대 구성하는게 훨씬 저렴.
* 시스템 구성에 유연.
    * 처음에 부하가 적을때는 서버에 최소한으로 투자.
    * 부하가 높아짐에 따라 서버를 늘려서 쉽게 확장 가능.

### 규모조정의 요소

그러나 스케일 아웃 전략은 부하가 많은 부분이 CPU인지 I/O인지에 따라 쉽게 적용할 수 있을지 없을지 나뉜다.

#### 1. CPU 부하

보통 웹 애플리케이션 서버의 로직에서 부하가 걸리는 경우인데, HTTP 요청에 대한 비즈니스 로직을 수행하고 필요시 DB에 질의한 후 결과를 가공해서 결과를 반환하는데 이 과정에서 I/O와 연관된 작업은 별로 없다.<br/>
오직 CPU의 계산에만 의존하며, 데이터를 분산해서 갖고있어야 하는 경우가 아니고 특정 작업을 처리하기만 하면 되기 때문에 동일한 비즈니스 로직을 수행하는 서버를 추가해서 로드밸런서로 부하를 분산해주기만 하면 된다. 

#### 2. I/O 부하

보통은 DB에 데이터가 너무 많이 쌓여서 검색에 대한 I/O 작입이 너무 오래걸리는 경우인데, 이런 경우에도 DB를 여러 대 둬서 DB에 대한 작업을 분산하려고 한다.<br/>
각각의 DB에 데이터를 갖고 있어야 하기 때문에 하나의 DB에 데이터를 저장한다고 하면, 이 저장된 데이터를 각 DB로 동기화시켜줘야 한다. 그래서 동기화를 어떻게 시켜줘야 하는지에 대한 문제가 있고, 더군다나 디스크가 느리기 때문에 이 문제는 더욱 어려워질 것이다. 그리고 디스크의 I/O가 많으면 많을수록, 데이터의 규모가 커지면 커질수록 어려움은 더 커질 것이다.<br/>
그래서 I/O에 부하가 있는 서버에 대해 스케일 아웃 전략을 적용하는 것은 간단하지가 않다.

## 멀티태스킹과 OS 부하

멀티태스킹 OS들은 여러 태스크를 CPU가 짧은 시간 간격으로 번갈아가면서 처리하도록 하면서 멀티태스킹을 구현한다. 그래서 특정 태스크가 CPU에 의해 처리되고 있는 상태라면, 다른 태스크들은 모두 대기해야 한다.

### Load Average 부하의 정체

리눅스에서 top 명령어에 나오는 Load Average값의 정체는 바로 이 대기중인 태스크 수를 의미한다고 할 수 있다. 하드웨어는 일정 주기로 타이머 인터럽트를 발생시키는데, 이 때 Load Average 값을 계산한다.<br/>
계산 방법은 CPU 할당 대기중인 프로세스와 I/O 대기중인 프로세스의 개수를 합쳐서 단위시간으로 나눠서 계산한다. 즉, Load Average는 당장 처리를 할 수 없어서 대기 중인 프로세스의 수라고 할 수 있다.<br/>
그래서 Load Average 만으로는 CPU 부하인지 I/O 부하인지 알 수 없기 때문에, 이 부하값이 높다면 좀 더 자세하게 확인할 필요가 있다.

<br/>

# 회고

## 아쉬운 점

단순히 공부만 하려니 동기부여가 잘 되지 않는다. 뭔가를 만들어보면서 공부를 해봐야 할까라는 생각이 든다. 그런데 항상 무엇을 만들어야 할지, 뭔가 의미있는것 만들어보고 싶은데라는 생각을 하면서 계속 미뤄왔었던 것 같다. 거창하게 엄청난 아이디어를 내서 뭔가를 만들어야겠다는 생각을 버려야겠다. 예전에 github 아이디를 만들고 첫 프로젝트로 했었던 책 관리 프로젝트가 생각나는데, 도서관리 프로젝트를 해봐야겠다. 가볍게 시작하자. 하면서 점점 기능을 이것저것 붙여보고 사용해보고 싶은 기술도 사용해보고 해봐야겠다.

